# SightMate Frontend

The frontend application of SightMate is a cross-platform mobile application designed to assist visually impaired users by providing real-time text recognition (OCR), object recognition (YOLO), and a capture-based visual question answering (VQA) and image captioning (IC) capabilities. The app leverages both on-device and online AI services, supports multiple languages, and offers a highly accessible, voice-driven interface.

---

## 1. Overview

SightMate empowers VI users to:

- Read printed text using OCR (offline and online modes)
- Recognize objects in real time using YOLO (Offline)
- Ask questions about images (VQA)
  - Request a caption about image (IC)
  - **Online only**
- Interact with the app using voice commands (Automatic Speech Recognition (ASR)/Text To Speech (TTS))
- Fully localized experience (English and Arabic)
  - Note: Localization is done for UI elements, but AI models may lack Arabic support.
- Accessibility driven UI desicsions, (Large texts, high contrast colors, adding description for interaction elements to support screen readers) 

The app is built with Flutter and follows modern best practices for architecture, state management, and internationalization (i18n).

---

## 2. Architectural Pattern

The project uses a **Vertical Slice Architecture** with minimized Clean Architecture layers (More suitable for the limited domain of the slice in Flutter applications):

- **Domain**: Business logic, abstract contracts, and core entities
- **Data**: Implements repositories/providers, handles API and storage, connects to external services
- **Presentation**: UI, state management, and user interaction logic
- **Both** Data and Presentation Layers depend on Domain, and ther're no dependecies between presentation and domain. This is done by adhering to Dependency Inversion Design Principle by using Dependency Injection (DI) techniques.

- Each feature (OCR, VQA, Object Recognition, etc.) is organized as a vertical slice, encapsulating its own domain, data, and presentation layers for maximum modularity and maintainability.
- Shared modules are also treated as slices.

- Some slices are utils only (No UI), so they may don't have presentation layer

---

## 3. Folder Structure and Roles

```
# Platform specific code (Generated by Flutter and contains some specifications added by developer)
android/
ios/

lib/              # Main source code
  main.dart           # Entry point

  app/                # App-wide config, dependency injection, routing, pop observer
  core/               # Some core abstractions (For result pattern, PageRouteSettings to generalize main pages for routing)
  modules/
    ocr/              # OCR (Optical Character Recognition) feature
      data/             # Data providers (online/offline), repositories
      domain/           # Entities, use cases, providers, repositories
      presentation/     # UI screens, widgets, routes, painters, utils

    vqa/              # Visual Question Answering feature
      data/             # Data providers, repositories
      domain/           # Entities, use cases, providers, repositories
      presentation/     # UI screens, widgets, routes

    yolo_object_recognition/ # Object recognition using YOLO (This slice is designed to match YOLO platform UI architecture)
      config/           # YOLO configuration
      controllers/      # Controller for YOLO logic
      screens/          # UI screens
      widgets/          # UI widgets

    shared/           # Shared modules used across features
      api_client/       # HTTP client with interceptor and secure storage
      asr/              # Automatic Speech Recognition (ASR)
      authentication/   # Authentication (login, register, profile)
      home/             # Home page and navigation command handler
      i18n/             # Internationalization (i18n) and localization (l10n)
      string_utils/     # String utilities (e.g., Levenshtein distance for ASR-based interaction)
      theme/            # Theme management (light/dark/system) [For future updates, this module will contain themes designed specifically for visually impairement cases]
      tts/              # Text-to-Speech (TTS)
      widgets/          # Shared UI widgets (drawer, scaffold, etc.)
assets/
  fonts/                # Custom fonts (Cairo)
  icon/                 # App icon
```

**Key Items:**

- `app/`: App-level setup (DI, config, routing)
- `core/`: Core abstractions used throughout the app
- `modules/`: Each feature is a vertical slice with its own domain, data, and presentation
- `shared/`: Reusable logic and UI across features (auth, theme, i18n, etc.)
- `assets/`: Fonts and icons

---

## 4. Requirements and Running on a Physical Android Device

### Requirements

- **Flutter SDK**: >=3.32.1
- **Dart SDK**: ^3.8.1
- **Android Studio** (or VS Code with Flutter plugin)
- **Physical Android Device** (with developer mode enabled)
- **.env file**: For Backend endpoint URIs (Please see [config.dart](./lib/app/config.dart), and [.env.example](./.env.example))

### How to Run

1. **Install Flutter & Dart**

   - [Flutter installation guide](https://docs.flutter.dev/get-started/install)
   - Ensure `flutter` and `dart` are in your PATH.

1. **Clone the Repository**

1. **Install Dependencies**

   ```sh
   flutter pub get
   ```

1. **Configure Environment**

   - Create a `.env` file in the project root just like [.env.example](./.env.example), or specify the link in [config.dart](./lib/app/config.dart).

1. **Connect Your Android Device**

   - Enable Developer Mode and USB Debugging on your device.
   - Connect via USB and ensure it appears with:
     ```sh
     flutter devices
     ```

6. **Run the App**
   ```sh
   flutter run
   ```
   - The app will build and deploy to your connected device.

**Notes:**

- The app uses several native plugins (camera, TTS, ASR, secure storage, etc.), so running on a real device is recommended.
- App is not tested for iOS since no suitable developement environment for iOS is available.
- The app supports both English and Arabic.

---

## 5. State Management, Dependency Injection, and Internationalization

### Provider Pattern for State Management

The project uses the [Provider](https://pub.dev/packages/provider) package as its main state management solution. Each major app state (such as theme, authentication, and localization) is managed by a `ChangeNotifier` class (e.g., [`ThemeNotifier`](./lib/modules/shared/theme/presentation/theme_notifier.dart), [`AuthenticationNotifier`](./lib/modules/shared/authentication/presentation/providers/authentication_notifier.dart), [`I18nNotifier`](./lib/modules/shared/i18n/presentation/i18n_notifier.dart)). These notifiers are registered at the root of the widget tree using `MultiProvider` in [`main.dart`](./lib/main.dart), making their state accessible throughout the app.

- **Why Provider?**  
  Provider is lightweight, easy to use, and integrates seamlessly with Flutter’s widget tree. It enables efficient state updates and clear separation of concerns between UI and business logic.

- **How it works:**
  - Notifiers are created and injected via dependency injection.
  - UI widgets use `Provider.of<T>(context)` or `Consumer<T>` to listen for changes and rebuild only when necessary.
  - Example: The app’s theme, language, and authentication state are all managed reactively using Provider.

### GetIt for Dependency Injection

The [GetIt](https://pub.dev/packages/get_it) package is used for dependency injection (DI), following the service locator pattern. This allows for loose coupling between components and makes the codebase more modular and testable.

- **How it works:**
  - All services, repositories, and notifiers are registered in [`injection.dart`](./lib/app/injection.dart) using `GetIt`.
  - At app startup, `configureDependencies()` in [`main.dart`](./lib/main.dart) is called to register and initialize all dependencies.
  - Throughout the app, dependencies are retrieved using `DI.get<T>()` or `DI<T>()`, ensuring a single instance (singleton) or lazy singleton is used as appropriate.
  - This approach makes it easy to swap implementations (e.g., for testing or platform-specific logic).

### Internationalization (i18n) and Localization (l10n) Support

The app UI is fully internationalized and localized, supporting both English and Arabic out of the box.

- **i18n (Internationalization):**

  - The app uses a repository and notifier pattern ([`I18nRepository`](./lib/modules/shared/i18n/domain/i18n_repository.dart), [`I18nNotifier`](./lib/modules/shared/i18n/presentation/i18n_notifier.dart)) to manage the current locale and persist user preferences.
  - The locale can be changed at runtime, **and the app will restart to apply the new language**.

- **l10n (Localization):**

  - The app uses the [Flutter Intl](https://pub.dev/packages/intl) package and ARB files for string localization.
  - All user-facing strings are defined in ARB files ([`intl_en.arb`](lib/modules/shared/i18n/data/l10n/arb/intl_en.arb), [`intl_ar.arb`](lib/modules/shared/i18n/data/l10n/arb/intl_ar.arb)), and Dart localization classes are generated automatically.
  - The `L10n` class provides access to localized strings, and the app is configured to support multiple locales via `localizationsDelegates` and `supportedLocales` in `MaterialApp` of [`main.dart`](./lib/main.dart).

- **How it works in code:**
  - The current locale is managed by `I18nNotifier` and provided to the app via Provider.
  - The `L10n.delegate` is included in the app’s `localizationsDelegates`.
  - Widgets use `L10n.of(context).someString` or fr simplicity `L10n.current.someString` to access localized text.

**Summary Table:**

| Concern              | Solution/Package | Location/Example                                                       |
| -------------------- | ---------------- | ---------------------------------------------------------------------- |
| State Management     | Provider         | `main.dart`, `ThemeNotifier`, `AuthenticationNotifier`, `I18nNotifier` |
| Dependency Injection | GetIt            | `app/injection.dart`, usage: `DI<T>()`                                 |
| Internationalization | Provider + Intl  | `I18nNotifier`, `L10n`, ARB files                                      |
| Localization         | Flutter Intl     | `lib/modules/shared/i18n/data/l10n/arb/`                               |

